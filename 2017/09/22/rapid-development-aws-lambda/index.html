<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="pipefail">

    <title>Rapid Development - pipefail</title>

    <link rel="canonical" href="https://www.pipefail.io/2017/09/22/rapid-development-aws-lambda/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Rapid Development | pipefail</title>
<meta property="og:title" content="Rapid Development" />
<meta name="author" content="Chris Lapa" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Serverless is awesome. The ability to run a snippet of code in the cloud in response to various triggers without having to manage infrastructure is beyond amazing especially if you don’t want to take on to much technical debt." />
<meta property="og:description" content="Serverless is awesome. The ability to run a snippet of code in the cloud in response to various triggers without having to manage infrastructure is beyond amazing especially if you don’t want to take on to much technical debt." />
<link rel="canonical" href="https://www.pipefail.io/2017/09/22/rapid-development-aws-lambda/" />
<meta property="og:url" content="https://www.pipefail.io/2017/09/22/rapid-development-aws-lambda/" />
<meta property="og:site_name" content="pipefail" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-09-22T00:00:00+00:00" />
<script type="application/ld+json">
{"name":null,"description":"Serverless is awesome. The ability to run a snippet of code in the cloud in response to various triggers without having to manage infrastructure is beyond amazing especially if you don’t want to take on to much technical debt.","url":"https://www.pipefail.io/2017/09/22/rapid-development-aws-lambda/","headline":"Rapid Development","dateModified":"2017-09-22T00:00:00+00:00","datePublished":"2017-09-22T00:00:00+00:00","sameAs":null,"@type":"BlogPosting","author":{"@type":"Person","name":"Chris Lapa"},"image":null,"publisher":null,"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.pipefail.io/2017/09/22/rapid-development-aws-lambda/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">pipefail</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                <li>
                    <a href="/about/">About</a>
                </li>
                
                <li>
                    <a href="/contact/">Contact</a>
                </li>
                
                <li>
                    <a href="/ctf/">CTF's</a>
                </li>
                
                <li>
                    
                </li>
                
                <li>
                    
                </li>
                
                <li>
                    
                </li>
                
                <li>
                    
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'pipefail'; // required: replace example with your forum shortname
    /* var disqus_developer = 1; // Comment out when the site is live */

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/lambda.png')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1 style=color:#9aeae5 >Rapid Development</h1>
                    
                    <h2 style=color:#9aeae5 class="subheading">AWS Lambda</h2>
                    
                    <span style=color:#9aeae5 class="meta">Posted by Chris Lapa on September 22, 2017</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<p>Serverless is awesome. The ability to run a snippet of code in the cloud in response to various triggers without having to manage
infrastructure is beyond amazing especially if you don’t want to take on to much technical debt.</p>

<p>One big gotcha with Serverless offerings such as AWS Lambda is how do you test your code if its running on some magical box in the cloud? 
Whilst there exists projects like <a href="https://github.com/ashiina/lambda-local">lambda-local</a> to test locally, I prefer to test on the environment in which its going to be deployed.
Testing in the cloud becomes more important if the function depends on some other AWS resources that aren’t accessible outside of your VPC.</p>

<p>My workspace for this kind of workflow usually has a few scripts per function, <code class="highlighter-rouge">mkdist.sh</code> and <code class="highlighter-rouge">run.sh</code>.</p>

<hr />

<h2 id="mkdistsh">mkdist.sh</h2>

<p>This script is dead simple and fairly dependant on the language you are working with. The example I have included is suited for Python 3.6 but should be easily adapted to suit other languages. It zips up the source code and sends it off to AWS using the CLI.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>

<span class="nv">DIR</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span> <span class="nb">cd</span> <span class="s2">"</span><span class="k">$(</span> dirname <span class="s2">"</span><span class="k">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="k">}</span><span class="s2">"</span> <span class="k">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> <span class="k">)</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="s2">"-----------------------------------------------------"</span>
<span class="nv">FUNCTION_NAME</span><span class="o">=</span><span class="s2">"&lt;function name&gt;"</span>
<span class="nv">ZIP_PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">FUNCTION_NAME</span><span class="k">}</span><span class="s2">.zip"</span>
<span class="nv">SRC_PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">DIR</span><span class="k">}</span><span class="s2">/source"</span>
rm <span class="s2">"</span><span class="k">${</span><span class="nv">ZIP_PATH</span><span class="k">}</span><span class="s2">"</span>

zip <span class="nt">-9</span> <span class="s2">"</span><span class="k">${</span><span class="nv">ZIP_PATH</span><span class="k">}</span><span class="s2">"</span>

<span class="nb">pushd</span> <span class="k">${</span><span class="nv">SRC_PATH</span><span class="k">}</span>
zip <span class="nt">-r9</span> <span class="k">${</span><span class="nv">ZIP_PATH</span><span class="k">}</span> app.py
<span class="nb">popd

pushd</span> <span class="k">${</span><span class="nv">SRC_PATH</span><span class="k">}</span>/lib/python3.6/site-packages
zip <span class="nt">-r9</span> <span class="k">${</span><span class="nv">ZIP_PATH</span><span class="k">}</span> <span class="k">*</span>
<span class="nb">popd

</span>aws lambda update-function-code <span class="nt">--publish</span> <span class="nt">--function-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">FUNCTION_NAME</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--zip-file</span> <span class="s2">"fileb://</span><span class="k">${</span><span class="nv">ZIP_PATH</span><span class="k">}</span><span class="s2">"</span></code></pre></figure>

<hr />

<h2 id="runsh---via-aws-cli">run.sh - via AWS CLI</h2>

<p>A simple wrapper around <code class="highlighter-rouge">aws lambda invoke</code> to make life a little easier. Payload is supplied via the <code class="highlighter-rouge">--payload</code> switch.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>

<span class="nv">DIR</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span> <span class="nb">cd</span> <span class="s2">"</span><span class="k">$(</span> dirname <span class="s2">"</span><span class="k">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="k">}</span><span class="s2">"</span> <span class="k">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> <span class="k">)</span><span class="s2">"</span>

<span class="nv">FUNCTION_NAME</span><span class="o">=</span><span class="s2">"&lt;function name&gt;"</span>
<span class="nv">REGION</span><span class="o">=</span><span class="s2">"&lt;region&gt;"</span>

aws lambda invoke <span class="nt">--function-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">FUNCTION_NAME</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--invocation-type</span> RequestResponse <span class="nt">--log-type</span> None <span class="nt">--region</span> <span class="s2">"</span><span class="k">${</span><span class="nv">REGION</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"</span><span class="k">${</span><span class="p">@</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"</span><span class="k">${</span><span class="nv">DIR</span><span class="k">}</span><span class="s2">/log.txt"</span> <span class="o">&amp;&amp;</span> tail <span class="nt">-F</span> <span class="s2">"</span><span class="k">${</span><span class="nv">DIR</span><span class="k">}</span><span class="s2">/log.txt"</span></code></pre></figure>

<hr />

<h2 id="runsh---via-api-gateway">run.sh - via API gateway</h2>

<p>Heres the fun stuff, this script depends on the awesome <a href="https://github.com/jorgebastida/awslogs">awslogs</a> package and that your function
is connected to an API Endpoint via API Gateway. Payload is supplied via the <code class="highlighter-rouge">-d</code> switch.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>

<span class="nv">FUNCTION_NAME</span><span class="o">=</span><span class="s2">"&lt;function name&gt;"</span>
<span class="nv">REGION</span><span class="o">=</span><span class="s2">"&lt;region&gt;"</span>
<span class="nv">API_KEY</span><span class="o">=</span><span class="s2">"&lt;api key&gt;"</span>
<span class="nv">API_ENDPOINT</span><span class="o">=</span><span class="s2">"&lt;api endpoint&gt;"</span>
<span class="nv">LOG_GROUP_NAME</span><span class="o">=</span><span class="s2">"/aws/lambda/</span><span class="k">${</span><span class="nv">FUNCTION_NAME</span><span class="k">}</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="s2">"Executing </span><span class="k">${</span><span class="nv">FUNCTION_NAME</span><span class="k">}</span><span class="s2"> with payload"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">PAYLOAD</span><span class="k">}</span><span class="s2">"</span>

<span class="nv">date</span><span class="o">=</span><span class="k">$(</span>date <span class="nt">-u</span> <span class="s1">'+%Y/%m/%d %H:%M:%S'</span><span class="k">)</span>
curl <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s2">"Accept: application/json"</span> <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">-H</span> <span class="s2">"x-api-key: </span><span class="k">${</span><span class="nv">API_KEY</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-i</span> <span class="s2">"</span><span class="k">${</span><span class="nv">API_ENDPOINT</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"</span><span class="k">${</span><span class="p">@</span><span class="k">}</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">exit </span>1
<span class="nb">echo</span> <span class="c"># Empty line</span>

awslogs get <span class="s2">"</span><span class="k">${</span><span class="nv">LOG_GROUP_NAME</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--watch</span> <span class="nt">--start</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">date</span><span class="k">}</span><span class="s2">"</span></code></pre></figure>



                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2017/09/15/goto-modules-python-logging/" data-toggle="tooltip" data-placement="top" title="Goto Modules">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2017/09/30/concurrent-futures-exceptions/" data-toggle="tooltip" data-placement="top" title="Exceptional concurrent.futures">Next Post &rarr;</a>
                    </li>
                    
                </ul>
                
                <div id="disqus_thread"></div>
                    <script type="text/javascript">
                        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                        var disqus_shortname = 'pipefail'; // required: replace example with your forum shortname
                        // var disqus_developer = 1; // Comment out when the site is live
                        var disqus_identifier = "/2017/09/22/rapid-development-aws-lambda/";

                        /* * * DON'T EDIT BELOW THIS LINE * * */
                        (function() {
                            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                    <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                
            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/Gus_Bricker">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/GusBricker">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="http://ko-fi.com/Buttons/Buy/574E2ZGZ45MK">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-coffee fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Chris Lapa 2017</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>

</div>
</body>

</html>
